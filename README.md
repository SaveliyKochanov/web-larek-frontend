# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Инструкция по сборке и запуску

После клонирования проекта из репозитория нужно установить зависимости:

```
npm install
```

Для запуска проекта в режиме разработки выполнить команду:

```
npm run start
```

или

```
yarn
yarn start
```

## Сборка

Для сборки проекта в продакшен выполнить команду:

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

- Товар

```
export interface IProduct {
	id: string;
	title: string;
	description: string;
	price: number | null;
	category: string;
	image: string;
}
```

---

- Покупатель

```
export interface ICustomerData {
	email: string;
	phone: string;
	payment: PaymentType;
	address: string;
}
```

- Интерфейс для модели данных продуктов

```
export interface IProductsData {
	products: IProduct[];
	preview: string | null;
}
```

## Архитектура

Проект построен по паттерну проектирования **`MVP`**.(_Model-View-Presenter_) — это широко распространенный шаблон проектирования, который помогает разработчикам создавать поддерживаемые, тестируемые и масштабируемые серверные приложения, разделяя задачи управления данными, пользовательского интерфейса и логики приложения. По нему приложение делится на три слоя:

1)**`Model`** — отвечает за логику работы с данными. Взаимодействует с _API_ для получения данных и их дальнейшего изменения.\
2)**`View`** — отвечает за отображение данных и пользовательский интерфейс.\
3)**`Presenter`** ( _EventEmitter_ ) — управляет взаимодействием между моделью и представлением. Реагирует на события интерфейса и изменяет модель.

### Базовый код

#### Класс `Api`

Этот код предоставляет основу для взаимодействия с сервером через _API_, поддерживая базовые методы работы с _HTTP_-запросами и обработки ответов.
Класс содержит методы:

- `handleResponse` - Логика обработки ответа сервера, вынесенная в отдельную функцию.
- `GET` - функция принимающая _url_ в качестве аргумента, и отправляющая на него _GET_-запрос.
- `POST` - функция принимающая _url_ , _data_ - объект с данными, представляющий собой тело запроса и метод передачи данных(по умолчанию _POST_).

#### Класс `EventEmitter`

Реализует паттерн "Наблюдатель" и позволяет подписываться на события и уведомлять подписчиков о наступлении события.
Класс имеет методы:

- `on` - для подписки на событие.
- `off` - для отписки от события.
- `emit` - уведомления подписчиков о наступлении события соответственно.
  Дополнительно были реализованы методы `onAll` и `offAll` - для подписки на все события и сброса всех подписчиков.

#### Класс `Component`

Представляет собой абстрактный класс, на основе которого базируются все остальные компоненты интерфейса. Он предоставляет общие методы для управления DOM-элементами, такие как переключение классов, установка текстового содержимого компонента или его изображения, управление видимостью и другие,

#### Класс `Model`

### Слой данных

#### Класс ProductsData

Класс отвечает за хранение данных товаров и логику работы с ними.
Конcтруктор класса принимает инстанс брокера событий. В полях класса хранятся следующие данные:

- \_products: IProduct[] - Массив объектов продуктов
- \_preview: string | null - id продукта, выбранного для просмотра
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- setProducts(products: IProduct[]): void - Метод для заполнения массива товаров
- getProducts(): IProduct[] - Возвращает массив товаров
- getProduct(id: string): IProduct - Возвращает один товар по его id
- saveProduct(product: IProduct): void - Метод для сохранения товаров
- savePreview(product: IProduct): void - Метод для сохранения Preview

#### Класс BasketData

Класс отвечает за хранение данных корзины и логику работы с ней.
Конструктор класса принимает инстанс брокера событий. В полях класса хранятся следующие данные:

- \_basket: IProduct[] - Массив объектов продуктов, добавленных в корзину.
- events: IEvents - Экземпляр класса `EventEmitter` для инициации событий при изменении состояния корзины.
  Класс предоставляет набор методов для взаимодействия с данными корзины:
- addToBasket(product: IProduct): void - Метод для добавления товара в корзину. При добавлении товара происходит эмитация события basket:changed, что может использоваться для обновления интерфейса.
- deleteFromBasket(product: IProduct): void - Метод для удаления товара из корзины.
- getProduct(id: string): IProduct | null - Возвращает один товар по его идентификатору. Если товар не найден, возвращает null.
- clearBasket(): void - Метод для очистки всей корзины.

#### Класс OrderData

Класс отвечает за хранение данных пользователя необходимых для оформления заказа и логику работы с ними. Конcтруктор класса принимает инстанс брокера событий. В полях класса хранятся следующие данные:

- \_formErrors: FormErrors - Объект содержащий ошибки валидации форм
- events: IEvents — Экземпляр класса `EventEmitter`, который используется для генерации событий, связанных с изменением данных или ошибок формы.
- \_order: IOrder — Объект, представляющий данные текущего заказа. Содержит следующие поля:
- total: number — Общая сумма заказа
- items: any[] — Массив товаров, включенных в заказ
- email: string — Электронная почта клиента
- phone: string — Номер телефона клиента
- address: string — Адрес доставки
- payment: string — Способ оплаты
  Класс предоставляет набор методов для взаимодействия с данными заказа:
- setOrderPayment(value: string): void - Устанавливает способ оплаты в заказе
- setOrderAddress(value: string): void - Устанавливает адрес доставки в заказе
- setOrderEmail(value: string): void - Устанавливает электронную почту в заказе.
- setOrderField(field: keyof TOrderInput, value: string): void -Обновляет любое поле заказа на основе его имени и значения, после чего инициирует валидацию.

validateOrder(): boolean - Выполняет валидацию заказа. Проверяет наличие значений в обязательных полях (email, phone, address, payment). Если одно из полей не заполнено, добавляет сообщение об ошибке в соответствующее

### Классы представления

Представление управляет отображением данных и обработкой событий пользовательского интерфейса, таких как клики на карточки товаров и кнопки.

#### Класс `Modal`

Реализует модальное окно. Предоставляет методы `open`, `close`, `render` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку крестик для закрытия модального окна.
Конструктор принимает два аргумента:

- container - корневой элемент модального окна в DOM, переданный в качестве `HTMLElement`.
- events - объект, реализующий интерфейс `IEvents`
  Поля класса:
- \_closeButton: HTMLButtonElement - кнопка для закрытия модального окна
- \_content - контейнер для содержимого модального окна
- events - брокер событий

#### Класс `Card`

Отвечает за отображение карточки, задавая в карточке данные категории, заголовка, изображения, цены и описания. Класс наследуется от родительского класса `Component` и используется для отображения карточек на странице сайта.
Поля класса содержат элементы разметки элементов карточки
Методы:

- setData(cardData: ICard) - заполняет атрибуты элементов карточки данными
- а также геттеры и сеттеры для свойств, отвечающих за данные карточки

#### Класс `BasketCard`

Отвечает за отображение и управление карточками товаров, добавленных в корзину. Он наследуется от класса `Card`, что означает, что базовая логика карточки также присутствует, но дополнительно добавлена функциональность для работы с корзиной, включая возможность удаления товаров.
Методы:

- set index(value: number) — сеттер для порядкового номера товара в корзине. Этот метод обновляет текстовое содержимое элемента \_index для отображения позиции товара в корзине.

#### Класс `Basket`

Класс Basket управляет корзиной товаров на странице и отвечает за отображение списка товаров, общей цены, а также за обработку действий пользователя, таких как оформление заказа. Класс наследуется от Component<IBasket>.
Методы:
set items(items: HTMLElement[]) — сеттер для обновления списка товаров в корзине.

#### Класс `OrderPayment`

Отвечает за управление выбором способа оплаты и адресом доставки в форме заказа. Он наследуется от класса `Form<TOrderPayment>`, что позволяет ему работать с формами, включающими поля, относящиеся к заказам. Взаимодействие с полями формы и кнопками оплаты осуществляется через DOM-элементы, а события изменений отправляются с помощью системы событий.
Поля класса:

- \_buttonOnline: HTMLButtonElement — кнопка для выбора оплаты онлайн (картой)
- \_buttonOnReceipt: HTMLButtonElement — кнопка для выбора оплаты при получении
- \_address: HTMLInputElement — поле для ввода адреса доставки.
  Методы:
- set address(value: string) — сеттер для поля адреса, который устанавливает адрес доставки.
- togglePayment(value: HTMLElement) — метод для переключения активного способа оплаты. Он сбрасывает предыдущий выбор и активирует выбранную кнопку.
- resetPayment() — метод для сброса состояния кнопок оплаты, используется при переключении кнопок.

#### Класс `OrderContacts`

Отвечает за управление контактной информацией (электронная почта и телефон) в форме заказа, наследуется от класса `Form<TOrderContact>`.
Поля класса:

- \_email: HTMLInputElement — поле ввода для электронной почты.
- \_phone: HTMLInputElement — поле ввода для номера телефона.
  Методы:
- set email(value: string) — сеттер для поля электронной почты. Этот метод одновременно устанавливает значение для поля электронной почты и поля телефона.

### Слой коммуникации

#### Класс WebApi

Данный класс принимает в конструктор экземпляр класс Api и предоставляет методы реализующие взаимодействие с backend-частью приложения

## Взаимодействие компонентов

Код, описывающий взаимодействие слоя представления и слоя данных между собой и фактически выполняющий роль презентера, находится в файле `index.ts`
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в `index.ts`
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделей данных)_

- `cards:changed` - изменение массива карточек
- `card:selected` - должна провоцировать открытие модального окна карточки
- `card:basket` - добавление товара в корзину
- `preview:changed` - изменение карточки в модальном окне
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `basket:open` - открываем интерфейс корзины
- `basket:close` - закрываем интерфейс корзины
- `basket:changed` - смена числа на счетчике товаров корзины, расположенной на главной странице, изменение суммы приобретенных товаров, изменение корзины
- `order:open` - открываем окно оформления заказа с первой формой
- `order:changed` - изменяем поля формы оформления заказа
- `/^order\..*:changed/` - устанавливает состояние валидности полей и инициирует передачу данных в соответствующие модели
- `order:submit` - открытие формы для заполнения контактной информации
- `contacts:submit` - отправка _post_-запроса на сервер, открытие окна, уведомляющего об успешном оформлении заказа, а также очистка разметки корзины
